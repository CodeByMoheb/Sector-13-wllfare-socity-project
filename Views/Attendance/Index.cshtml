@model (IEnumerable<Sector_13_Welfare_Society___Digital_Management_System.Models.Employee> employees, IEnumerable<Sector_13_Welfare_Society___Digital_Management_System.Models.Attendance> attendance)
@{
    ViewData["Title"] = "Attendance";
    Layout = "_DashboardLayout";
    var date = ViewBag.Date as DateTime? ?? DateTime.Today;
}

<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h2>Attendance for @date.ToString("dd MMM yyyy")</h2>
        <div>
            <a href="@Url.Action("Index", "Attendance")" class="btn btn-primary me-2">Take Attendance</a>
            <a href="@Url.Action("Report", "Attendance", new { from = date.ToString("yyyy-MM-dd"), to = date.ToString("yyyy-MM-dd") })" class="btn btn-info">View Attendance Report</a>
        </div>
    </div>
    @if (TempData["AttendanceSaved"] != null) {
        <div class="alert alert-success">@TempData["AttendanceSaved"]</div>
    }
    <form asp-action="Mark" method="post">
        <input type="hidden" name="date" value="@date.ToString("yyyy-MM-dd")" />
        <table class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Role</th>
                    <th>Present</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var emp in Model.employees)
            {
                var att = Model.attendance.FirstOrDefault(a => a.EmployeeId == emp.Id);
                <tr>
                    <td>@emp.Name</td>
                    <td>@emp.Role</td>
                    <td>
                        <input type="checkbox" name="presentEmployeeIds" value="@emp.Id" @(att != null && att.IsPresent ? "checked" : "") />
                        @if (att != null) {
                            <a href="@Url.Action("Edit", "Attendance", new { employeeId = emp.Id, date = date.ToString("yyyy-MM-dd") })" class="btn btn-sm btn-primary ms-2">Edit</a>
                        }
                    </td>
                </tr>
            }
            </tbody>
        </table>
        <button type="submit" class="btn btn-success">Save Attendance</button>
    </form>
    <form method="get" class="mt-3">
        <label for="date">Change Date:</label>
        <input type="date" id="date" name="date" value="@date.ToString("yyyy-MM-dd")" />
        <button type="submit" class="btn btn-primary">Go</button>
    </form>
</div> 