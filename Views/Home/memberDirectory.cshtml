@{
    ViewData["Title"] = "Member Directory";
}
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card shadow-sm border-0">
                <div class="card-body">
                    <h2 class="card-title text-center mb-4" style="font-weight:700;color:#2c3e50;">Members' Directory 2022</h2>
                    <p class="text-center text-muted mb-4">View the latest member directory directly below. You can also download it if you wish.</p>
                    <div id="pdf-controls" class="d-flex justify-content-center align-items-center mb-3" style="gap:1rem;">
                        <button id="prev-page" class="btn btn-secondary btn-sm"><i class="fa fa-chevron-left"></i></button>
                        <span>Page <span id="page-num">1</span> of <span id="page-count">?</span></span>
                        <button id="next-page" class="btn btn-secondary btn-sm"><i class="fa fa-chevron-right"></i></button>
                    </div>
                    <div id="pdf-viewer" style="min-height:600px; background:#f8f9fa; border-radius:8px; box-shadow:0 2px 8px rgba(44,62,80,0.08); text-align:center;"></div>
                    <div class="text-center mt-3">
                        <a class="btn btn-outline-primary" href="/memberDirectory/mdir.pdf" download>
                            <i class="fa fa-download me-2"></i>Download PDF
                        </a>
                    </div>
                    <div class="text-center text-muted mt-2" style="font-size:0.95em;">
                        <small>If the PDF does not display, <a href="/memberDirectory/mdir.pdf" target="_blank">click here to open it in a new tab</a>.</small>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
    const url = '/memberDirectory/mdir.pdf';
    const pdfjsLib = window['pdfjs-dist/build/pdf'];
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    let pdfDoc = null,
        pageNum = 1,
        pageRendering = false,
        pageNumPending = null,
        scale = 1.2,
        canvas = document.createElement('canvas'),
        ctx = canvas.getContext('2d');
    document.getElementById('pdf-viewer').appendChild(canvas);

    function renderPage(num) {
        pageRendering = true;
        pdfDoc.getPage(num).then(function(page) {
            const viewport = page.getViewport({ scale: scale });
            canvas.height = viewport.height;
            canvas.width = viewport.width;
            let renderContext = {
                canvasContext: ctx,
                viewport: viewport
            };
            let renderTask = page.render(renderContext);
            renderTask.promise.then(function() {
                pageRendering = false;
                document.getElementById('page-num').textContent = num;
                if (pageNumPending !== null) {
                    renderPage(pageNumPending);
                    pageNumPending = null;
                }
            });
        });
    }

    function queueRenderPage(num) {
        if (pageRendering) {
            pageNumPending = num;
        } else {
            renderPage(num);
        }
    }

    function onPrevPage() {
        if (pageNum <= 1) return;
        pageNum--;
        queueRenderPage(pageNum);
    }
    function onNextPage() {
        if (pageNum >= pdfDoc.numPages) return;
        pageNum++;
        queueRenderPage(pageNum);
    }

    document.getElementById('prev-page').addEventListener('click', onPrevPage);
    document.getElementById('next-page').addEventListener('click', onNextPage);

    pdfjsLib.getDocument(url).promise.then(function(pdfDoc_) {
        pdfDoc = pdfDoc_;
        document.getElementById('page-count').textContent = pdfDoc.numPages;
        renderPage(pageNum);
    }).catch(function(error) {
        document.getElementById('pdf-viewer').innerHTML = '<div class="alert alert-danger">Failed to load PDF. <a href="' + url + '" target="_blank">Click here to open it in a new tab.</a></div>';
        document.getElementById('pdf-controls').style.display = 'none';
    });
</script> 