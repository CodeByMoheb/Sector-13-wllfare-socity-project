@using Microsoft.AspNetCore.Identity
@using Sector_13_Welfare_Society___Digital_Management_System.Models
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
@{
    var userName = User.Identity?.Name ?? "User";
    var roles = User.Claims.Where(c => c.Type == System.Security.Claims.ClaimTypes.Role).Select(c => c.Value).ToList();
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Dashboard | Sector 13 Welfare Society</title>
    <link rel="icon" type="image/x-icon" href="~/Photos/favicon.png" />
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
</head>
<body>
    <div class="dashboard-wrapper">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <img src="@Url.Content("~/Photos/logo.png")" alt="Logo" style="height:40px; margin-bottom:10px;" />
                <div>Dashboard</div>
            </div>
            <ul>
                <li><a href="@Url.Action("Admin", "Dashboard")" class="@(roles.Contains("Admin") ? "active" : "")">Admin</a></li>
                <li><a href="@Url.Action("Manager", "Dashboard")" class="@(roles.Contains("Manager") ? "active" : "")">Manager</a></li>
                <li><a href="@Url.Action("Member", "Dashboard")" class="@(roles.Contains("Member") ? "active" : "")">Member</a></li>
                <li><a href="@Url.Action("President", "Dashboard")" class="@(roles.Contains("President") ? "active" : "")">President</a></li>
                <li><a href="@Url.Action("Secretary", "Dashboard")" class="@(roles.Contains("Secretary") ? "active" : "")">Secretary</a></li>
            </ul>
        </nav>
        <!-- Mainbar -->
        <div class="mainbar">
            <!-- Topbar -->
            <div class="topbar">
                <div style="display:flex;align-items:center;gap:1rem;">
                    <img src="@Url.Content("~/Photos/logo.png")" alt="Logo" style="height:36px; border-radius:8px; box-shadow:0 2px 8px rgba(91,63,162,0.08);" />
                    <span style="font-family:'Li Shadhinata',sans-serif;font-size:1.3rem;color:#5b3fa2;font-weight:700;letter-spacing:1px;">উত্তরা সেক্টর ১৩</span>
                </div>
                <form class="d-none d-md-block" style="margin-left:2rem;">
                    <input class="search-bar" type="search" placeholder="Search members, events..." aria-label="Search" />
                </form>
                <button class="theme-switcher btn btn-light border" onclick="toggleTheme()" aria-label="Switch theme"><i class="fas fa-moon"></i></button>
                <a href="#" class="manubar-link" style="margin-left:1rem;" title="Help & Support"><i class="fas fa-question-circle"></i> Help</a>
                <div class="manubar-options d-none d-md-flex" style="gap:1.5rem;align-items:center;">
                    <a href="@Url.Action("AboutUs", "Home")" class="manubar-link">About Society</a>
                    <a href="@Url.Action("Gallery", "Home")" class="manubar-link">Gallery</a>
                    <a href="@Url.Action("ContactUs", "Home")" class="manubar-link">Contact</a>
                    <a href="@Url.Action("donate", "Home")" class="manubar-link donate">Donate</a>
                </div>
                <div class="notifications position-relative" style="margin-right:1.2rem;">
                    <button class="btn btn-link p-0 border-0 notifications-btn" onclick="toggleNotificationsDropdown()" aria-label="Notifications">
                        <i class="fas fa-bell" style="font-size:1.4rem;color:#5b3fa2;"></i>
                        <span id="notificationDot" style="position:absolute;top:2px;right:2px;width:10px;height:10px;background:#fbbf24;border-radius:50%;display:inline-block;"></span>
                    </button>
                    <div id="notificationsDropdown" class="notifications-dropdown shadow-lg" style="display:none;position:absolute;right:0;top:40px;min-width:300px;background:#fff;border-radius:12px;padding:1rem;z-index:9999;">
                        <div class="mb-2" style="font-weight:600;color:#5b3fa2;">Notifications</div>
                        <div class="notification-item mb-2" style="font-size:0.98rem;color:#333;">
                            <i class="fas fa-info-circle text-primary me-2"></i> Welcome to the Welfare Society Dashboard!
                        </div>
                        <div class="notification-item mb-2" style="font-size:0.98rem;color:#333;">
                            <i class="fas fa-calendar-alt text-success me-2"></i> Upcoming event: Annual General Meeting on 25th July.
                        </div>
                        <div class="notification-item" style="font-size:0.98rem;color:#333;">
                            <i class="fas fa-bullhorn text-warning me-2"></i> New notice: Maintenance work on 20th July.
                        </div>
                    </div>
                </div>
                <button class="menu-toggle d-md-none" aria-label="Open menu" onclick="toggleSidebarMenu()"><i class="fas fa-bars"></i></button>
                <div class="user-info position-relative">
                    <button class="btn btn-link p-0 border-0 user-profile-btn" onclick="toggleProfileDropdown()" aria-label="User Profile">
                        <img src="@(ViewBag.ProfilePictureUrl ?? Url.Content("~/Photos/logo.png"))" alt="Profile" class="rounded-circle" style="height:36px;width:36px;object-fit:cover;border:2px solid #e0e7ff;box-shadow:0 2px 8px rgba(91,63,162,0.08);background:#fff;">
                    </button>
                    <div id="profileDropdown" class="profile-dropdown shadow-lg" style="display:none;position:absolute;right:0;top:48px;min-width:260px;background:#fff;border-radius:12px;padding:1.2rem 1.2rem 1rem 1.2rem;z-index:9999;">
                        <div class="text-center mb-2">
                            <form method="post" enctype="multipart/form-data" action="@Url.Action("UploadAvatar", "Account")">
                                <label for="avatarUpload" style="cursor:pointer;">
                                    <img src="@(ViewBag.ProfilePictureUrl ?? Url.Content("~/Photos/logo.png"))" alt="Profile" class="rounded-circle mb-2" style="height:60px;width:60px;object-fit:cover;border:2px solid #e0e7ff;background:#f3e8ff;">
                                    <input type="file" id="avatarUpload" name="avatar" style="display:none;" onchange="this.form.submit()" accept="image/*" />
                                </label>
                            </form>
                            <h5 class="mb-0" style="color:#5b3fa2;font-weight:700;">@User.Identity?.Name</h5>
                        </div>
                        <div class="profile-completeness-bar mb-2">
                            <div class="profile-completeness-bar-inner" style="width:@(ViewBag.ProfileCompleteness ?? 60)%"></div>
                        </div>
                        <div class="mb-1"><strong>Name:</strong> @ViewBag.FullName ?? "-"</div>
                        <div class="mb-1"><strong>Address:</strong> @ViewBag.Address ?? "-"</div>
                        <div class="mb-1"><strong>Phone:</strong> @ViewBag.Phone ?? "-"</div>
                        <div class="mb-1"><strong>Email:</strong> @ViewBag.Email ?? "-"</div>
                        <div class="mb-1"><strong>Last Login:</strong> @ViewBag.LastLogin ?? "-"</div>
                        <div class="mt-2 text-center">
                            <a href="@Url.Action("EditProfile", "Account")" class="btn btn-outline-primary btn-sm">Edit Profile</a>
                        </div>
                        <div class="mt-2 text-center">
                            <form asp-controller="Account" asp-action="Logout" method="post" style="display:inline;">
                                <button type="submit" class="btn btn-outline-danger btn-sm">Sign Out</button>
                            </form>
                        </div>
                        <div class="mt-2">
                            <a href="@Url.Action("ChangePassword", "Account")" class="settings-link"><i class="fas fa-key"></i> Change Password</a>
                            <a href="@Url.Action("Settings", "Account")" class="settings-link"><i class="fas fa-cog"></i> Settings & Preferences</a>
                        </div>
                        <div class="mt-2">
                            <div class="security-tip"><i class="fas fa-shield-alt"></i> Tip: Use a strong password and update it regularly.</div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Main Content -->
            <div class="main-content">
                @* Role-based Quick Actions *@
                <div class="quick-actions mb-4">
                    @if (roles.Contains("Admin")) {
                        <div class="d-flex flex-wrap gap-2 mb-2">
                            <a href="@Url.Action("ListUsers", "UserManagement")" class="btn btn-primary"><i class="fas fa-users"></i> Manage Users</a>
                            <a href="@Url.Action("Create", "Project")" class="btn btn-success"><i class="fas fa-plus"></i> New Project</a>
                            <a href="@Url.Action("ViewUsers", "Database")" class="btn btn-info"><i class="fas fa-database"></i> View Database</a>
                        </div>
                    } else if (roles.Contains("Manager")) {
                        <div class="d-flex flex-wrap gap-2 mb-2">
                            <a href="#" class="btn btn-warning"><i class="fas fa-tasks"></i> Assign Task</a>
                            <a href="#" class="btn btn-success"><i class="fas fa-check"></i> Mark Complete</a>
                        </div>
                    } else if (roles.Contains("Member")) {
                        <div class="d-flex flex-wrap gap-2 mb-2">
                            <a href="#" class="btn btn-info"><i class="fas fa-eye"></i> View Activities</a>
                            <a href="#" class="btn btn-success"><i class="fas fa-comment"></i> Give Feedback</a>
                        </div>
                    } else if (roles.Contains("President")) {
                        <div class="d-flex flex-wrap gap-2 mb-2">
                            <a href="#" class="btn btn-primary"><i class="fas fa-calendar-alt"></i> Schedule Meeting</a>
                            <a href="#" class="btn btn-info"><i class="fas fa-file-signature"></i> Approve Projects</a>
                        </div>
                    } else if (roles.Contains("Secretary")) {
                        <div class="d-flex flex-wrap gap-2 mb-2">
                            <a href="#" class="btn btn-info"><i class="fas fa-file-upload"></i> Upload Document</a>
                            <a href="#" class="btn btn-warning"><i class="fas fa-bullhorn"></i> Send Notice</a>
                        </div>
                    }
                </div>
                <div class="recent-activity mb-4">
                    <div class="card shadow-sm">
                        <div class="card-header bg-white" style="color:#5b3fa2;font-weight:600;">Recent Activity</div>
                        <div class="card-body p-3">
                            <ul class="list-unstyled mb-0">
                                <li><i class="fas fa-user-plus text-success me-2"></i> New member registered: John Doe <span class="text-muted small">2 min ago</span></li>
                                <li><i class="fas fa-calendar-check text-primary me-2"></i> Event created: Blood Donation Camp <span class="text-muted small">1 hour ago</span></li>
                                <li><i class="fas fa-edit text-warning me-2"></i> Profile updated: Jane Smith <span class="text-muted small">3 hours ago</span></li>
                            </ul>
                        </div>
                    </div>
                </div>
                @RenderBody()
            </div>
            <!-- Footer -->
            <footer class="main-footer">
                <div class="footer-container">
                    <div class="footer-links mb-2">
                        <a href="#">Privacy Policy</a>|
                        <a href="#">Terms of Service</a>|
                        <a href="https://facebook.com" target="_blank"><i class="fab fa-facebook"></i></a>
                        <a href="https://youtube.com" target="_blank"><i class="fab fa-youtube"></i></a>
                    </div>
                    <div>Copyright © 2025 উত্তরা সেক্টর ১৩ ওয়েলফেয়ার সোসাইটি. All rights reserved.</div>
                </div>
            </footer>
        </div>
    </div>
    @await RenderSectionAsync("Scripts", required: false)
    <script>
function toggleSidebarMenu() {
    const sidebar = document.querySelector('.sidebar');
    if (sidebar) {
        sidebar.style.display = (sidebar.style.display === 'block' ? 'none' : 'block');
    }
}
window.addEventListener('resize', function() {
    const sidebar = document.querySelector('.sidebar');
    if (window.innerWidth > 600 && sidebar) {
        sidebar.style.display = '';
    }
});
function toggleProfileDropdown() {
    const dropdown = document.getElementById('profileDropdown');
    if (dropdown) {
        dropdown.style.display = (dropdown.style.display === 'block' ? 'none' : 'block');
    }
}
document.addEventListener('click', function(event) {
    const dropdown = document.getElementById('profileDropdown');
    const btn = document.querySelector('.user-profile-btn');
    if (dropdown && btn && !btn.contains(event.target) && !dropdown.contains(event.target)) {
        dropdown.style.display = 'none';
    }
});
function toggleNotificationsDropdown() {
    const dropdown = document.getElementById('notificationsDropdown');
    if (dropdown) {
        dropdown.style.display = (dropdown.style.display === 'block' ? 'none' : 'block');
    }
}
document.addEventListener('click', function(event) {
    const dropdown = document.getElementById('notificationsDropdown');
    const btn = document.querySelector('.notifications-btn');
    if (dropdown && btn && !btn.contains(event.target) && !dropdown.contains(event.target)) {
        dropdown.style.display = 'none';
    }
});
function toggleTheme() {
    document.body.classList.toggle('dark-theme');
    if(document.body.classList.contains('dark-theme')) {
        localStorage.setItem('theme', 'dark');
    } else {
        localStorage.setItem('theme', 'light');
    }
}
window.onload = function() {
    if(localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark-theme');
    }
}
</script>
</body>
</html> 