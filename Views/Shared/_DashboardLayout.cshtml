@using Microsoft.AspNetCore.Identity
@using Sector_13_Welfare_Society___Digital_Management_System.Models
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
@{
    var userName = User.Identity?.Name ?? "User";
    var roles = User.Claims.Where(c => c.Type == System.Security.Claims.ClaimTypes.Role).Select(c => c.Value).ToList();
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="google-site-verification" content="7elQopzAjDXovrXO9xcC1begtgUBoljhtkcYvVaE1No" />
    <title>@ViewData["Title"] - Dashboard | Sector 13 Welfare Society</title>
    <link rel="icon" type="image/x-icon" href="~/Photos/favicon.png" />
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
    <style>
        .quick-actions .btn {
            border-radius: 2rem;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(91,63,162,0.08);
            transition: transform 0.18s cubic-bezier(.4,2,.6,1), box-shadow 0.18s, background 0.18s;
            padding: 0.75rem 1.5rem;
            font-size: 1.05rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .quick-actions .btn i {
            font-size: 1.2em;
        }
        .quick-actions .btn:hover, .quick-actions .btn:focus {
            transform: scale(1.07) translateY(-2px);
            box-shadow: 0 6px 18px rgba(91,63,162,0.18);
            filter: brightness(1.08);
        }
        .quick-actions .btn-outline-primary {
            background: linear-gradient(90deg, #6a11cb 0%, #2575fc 100%);
            color: #fff;
            border: none;
        }
        .quick-actions .btn-outline-success {
            background: linear-gradient(90deg, #11998e 0%, #38ef7d 100%);
            color: #fff;
            border: none;
        }
        .quick-actions .btn-outline-info {
            background: linear-gradient(90deg, #43cea2 0%, #185a9d 100%);
            color: #fff;
            border: none;
        }
        .quick-actions .btn-outline-danger {
            background: linear-gradient(90deg, #ff512f 0%, #dd2476 100%);
            color: #fff;
            border: none;
        }
        .quick-actions .btn-info {
            background: linear-gradient(90deg, #2193b0 0%, #6dd5ed 100%);
            color: #fff;
            border: none;
        }
        .quick-actions .btn-success {
            background: linear-gradient(90deg, #56ab2f 0%, #a8e063 100%);
            color: #fff;
            border: none;
        }
    </style>
</head>
<body>
    <div class="dashboard-wrapper">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header d-flex justify-content-center align-items-center">
                <a href="@Url.Action("Index", "Home")"><img src="https://res.cloudinary.com/ddl4hnmnz/image/upload/v1752470485/logo_ujgjlu.png" alt="Logo" class="sidebar-logo" /> </a>
                <button class="sidebar-toggle-btn" onclick="toggleSidebar()" aria-label="Toggle sidebar">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>
            <div class="sidebar-title text-center fw-bold">Dashboard</div>
            <hr>
            <ul class="sidebar-menu">
                @if (roles.Contains("Manager")) {
                    <li class="sidebar-section sidebar-dropdown-parent">
                        <a href="#" class="sidebar-dropdown-toggle" onclick="toggleSidebarDropdown(event)">
                            <span>Employee Management <i class="fas fa-chevron-down ms-1"></i></span>
                        </a>
                        <ul class="sidebar-dropdown" style="display:none;">
                            <li><a href="@Url.Action("Index", "Employee")"><i class="fas fa-users"></i> <span class="menu-text">Employees</span></a></li>
                            <li><a href="@Url.Action("Index", "Attendance")"><i class="fas fa-calendar-check"></i> <span class="menu-text">Attendance</span></a></li>
                            <li><a href="@Url.Action("Index", "SalaryCalculator")"><i class="fas fa-money-check-alt"></i> <span class="menu-text">Salary</span></a></li>
                        </ul>
                    </li>
                    <li class="sidebar-section sidebar-dropdown-parent">
                        <a href="#" class="sidebar-dropdown-toggle" onclick="toggleSidebarDropdown(event)">
                            <span>Notice <i class="fas fa-chevron-down ms-1"></i></span>
                        </a>
                        <ul class="sidebar-dropdown" style="display:none;">
                            <li><a href="@Url.Action("Create", "Notice")"><i class="fas fa-plus"></i> <span class="menu-text">Create Notice</span></a></li>
                            <li><a href="@Url.Action("ManagerList", "Notice")"><i class="fas fa-list"></i> <span class="menu-text">My Notices</span></a></li>
                            <li><a href="@Url.Action("Notifications", "ManagerTools")"><i class="fas fa-bell"></i> <span class="menu-text">Notifications Status</span></a></li>
                        </ul>
                    </li>
                    <li class="sidebar-section sidebar-dropdown-parent">
                        <a href="#" class="sidebar-dropdown-toggle" onclick="toggleSidebarDropdown(event)">
                            <span>Permanent Members <i class="fas fa-chevron-down ms-1"></i></span>
                        </a>
                        <ul class="sidebar-dropdown" style="display:none;">
                            <li><a href="@Url.Action("ManagerList", "PermanentMember")"><i class="fas fa-address-book"></i> <span class="menu-text">Members</span></a></li>
                        </ul>
                    </li>
                }
                @if (roles.Contains("Admin")) {
                    <li><a href="@Url.Action("ListUsers", "UserManagement")" class="@(roles.Contains("Admin") ? "active" : "")">
                        <i class="fas fa-users"></i>
                        <span class="menu-text">Admin</span>
                    </a></li>
                    <li class="sidebar-section sidebar-dropdown-parent">
                        <a href="#" class="sidebar-dropdown-toggle" onclick="toggleSidebarDropdown(event)">
                            <span>Notice Management <i class="fas fa-chevron-down ms-1"></i></span>
                        </a>
                        <ul class="sidebar-dropdown" style="display:none;">
                            <li><a href="@Url.Action("AllNotices", "Notice")"><i class="fas fa-list"></i> <span class="menu-text">All Notices</span></a></li>
                            <li><a href="@Url.Action("PublicList", "Notice")"><i class="fas fa-eye"></i> <span class="menu-text">Published Notices</span></a></li>
                        </ul>
                    </li>
                }
                @if (roles.Contains("Member")) {
                    <li><a href="@Url.Action("Member", "Dashboard")" class="@(roles.Contains("Member") ? "active" : "")">
                        <i class="fas fa-user"></i>
                        <span class="menu-text">Member</span>
                    </a></li>
                }
                @if (roles.Contains("President")) {
                    <li><a href="@Url.Action("President", "Dashboard")" class="@(roles.Contains("President") ? "active" : "")">
                        <i class="fas fa-crown"></i>
                        <span class="menu-text">President</span>
                    </a></li>
                }
                @if (roles.Contains("Secretary")) {
                    <li><a href="@Url.Action("Secretary", "Dashboard")" class="@(roles.Contains("Secretary") ? "active" : "")">
                        <i class="fas fa-user-graduate"></i>
                        <span class="menu-text">Secretary</span>
                    </a></li>
                    <li class="sidebar-section sidebar-dropdown-parent">
                        <a href="#" class="sidebar-dropdown-toggle" onclick="toggleSidebarDropdown(event)">
                            <span>Notice Management <i class="fas fa-chevron-down ms-1"></i></span>
                        </a>
                        <ul class="sidebar-dropdown" style="display:none;">
                            <li><a href="@Url.Action("SecretaryList", "Notice")"><i class="fas fa-clock"></i> <span class="menu-text">Pending Approvals</span></a></li>
                            <li><a href="@Url.Action("PublicList", "Notice")"><i class="fas fa-eye"></i> <span class="menu-text">Published Notices</span></a></li>
                        </ul>
                    </li>
                }
            </ul>
        </nav>
        <!-- Mobile overlay for sidebar -->
        <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>
        
        <!-- Mainbar -->
        <div class="mainbar" id="mainbar">
            <!-- Topbar -->
            <div class="topbar">
                <div class="topbar-left">
                    <button class="sidebar-toggle-mobile" onclick="toggleSidebar()" aria-label="Toggle sidebar">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="brand-section">
                        <img src="https://res.cloudinary.com/ddl4hnmnz/image/upload/v1752470485/logo_ujgjlu.png" alt="Logo" class="logo-img" />
                        <span class="brand-text">উত্তরা সেক্টর ১৩</span>
                    </div>
                </div>
               
                <div class="topbar-center">
                    <form class="d-none d-md-block">
                        <input class="search-bar" type="search" placeholder="Search members, events..." aria-label="Search" />
                    </form>
                </div>
                <div class="topbar-right">
                    
                    <button class="theme-switcher btn btn-light border" onclick="toggleTheme()" aria-label="Switch theme">
                        <i class="fas fa-moon"></i>
                    </button>
                    <a href="#" class="manubar-link" title="Help & Support">
                        <i class="fas fa-question-circle"></i> 
                        <span class="d-none d-md-inline">Help</span>
                    </a>
                    <div class="manubar-options d-none d-lg-flex">
                        <a href="@Url.Action("AboutUs", "Home")" class="manubar-link">About Society</a>
                        <a href="@Url.Action("Gallery", "Home")" class="manubar-link">Gallery</a>
                        <a href="@Url.Action("ContactUs", "Home")" class="manubar-link">Contact</a>
                        <a href="@Url.Action("donate", "Home")" class="manubar-link donate">Donate</a>
                    </div>
                    <div class="notifications position-relative">
                        <button class="p-0 border-0 notifications-btn" onclick="toggleNotificationsDropdown()" aria-label="Notifications">
                            <i class="fas fa-bell"></i>
                            <span id="notificationDot" class="notification-dot"></span>
                        </button>
                        <div id="notificationsDropdown" class="notifications-dropdown shadow-lg">
                            <div class="notification-header">Notifications</div>
                            <div class="notification-item">
                                <i class="fas fa-info-circle text-primary me-2"></i> Welcome to the Welfare Society Dashboard!
                            </div>
                            <div class="notification-item">
                                <i class="fas fa-calendar-alt text-success me-2"></i> Upcoming event: Annual General Meeting on 25th July.
                            </div>
                            <div class="notification-item">
                                <i class="fas fa-bullhorn text-warning me-2"></i> New notice: Maintenance work on 20th July.
                            </div>
                        </div>
                    </div>


                 

                </div>



                <div class="dropdown user-info position-relative " style="margin-left: 15px;">
                    <button class="p-0 border-0 user-profile-btn dropdown-toggle" type="button" id="profileDropdownBtn" data-bs-toggle="dropdown" aria-expanded="false">

                        <img src="@(ViewBag.ProfilePictureUrl ?? Url.Content("~/Photos/logo.png"))" alt="Profile" class="rounded-circle" style="height:36px;width:36px;object-fit:cover;border:2px solid #e0e7ff;box-shadow:0 2px 8px rgba(91,63,162,0.08);background:#fff;">
                    </button>
                    <ul class="dropdown-menu dropdown-menu-end p-0" aria-labelledby="profileDropdownBtn" style="min-width: 260px; border-radius: 16px; overflow: hidden;">
                        <li class="profile-header text-center p-3" >
                            <img src="@(ViewBag.ProfilePictureUrl ?? Url.Content("~/Photos/logo.png"))" alt="Profile" class="rounded-circle mb-2" style="width:100px;height:100px;">
                            <div class="fw-bold" style="color: #333;">@ViewBag.FullName</div>
                            <div style="font-size:0.95rem;color:#333">@ViewBag.Role</div>
                        </li>
                        <li>
                            <form method="get" action="@Url.Action("EditProfile", "Account")" class="m-0">
                                <button type="submit" class="dropdown-item d-flex align-items-center gap-2">
                                    <i class="fas fa-user-edit"></i> Edit Profile
                                </button>
                            </form>
                        </li>
                        <li>
                            <form method="get" action="@Url.Action("ChangePassword", "Account")" class="m-0">
                                <button type="submit" class="dropdown-item d-flex align-items-center gap-2">
                                    <i class="fas fa-key"></i> Change Password
                                </button>
                            </form>
                        </li>
                        <li><hr class="dropdown-divider"></li>
                        <li>
                            <form asp-controller="Account" asp-action="Logout" method="post" class="m-0">
                                <button type="submit" class="dropdown-item text-danger d-flex align-items-center gap-2">
                                    <i class="fas fa-sign-out-alt"></i> Sign Out
                                </button>
                            </form>
                        </li>
                    </ul>

                </div>
            </div>
            <!-- Main Content -->
            <div class="main-content">
                @* Role-based Quick Actions *@
                <div class="quick-actions mb-4">
                    @if (roles.Contains("Admin")) {
                        <div class="d-flex flex-wrap gap-2 mb-2">
                            <a href="@Url.Action("ListUsers", "UserManagement")" class="btn btn-primary"><i class="fas fa-users"></i> Manage Users</a>
                            <a href="@Url.Action("Create", "Project")" class="btn btn-success"><i class="fas fa-plus"></i> New Project</a>
                            <a href="@Url.Action("ViewUsers", "Database")" class="btn btn-info"><i class="fas fa-database"></i> View Database</a>
                        </div>
                    } else if (roles.Contains("Manager")) {
                        <div class="d-flex flex-wrap gap-2 mb-2">
                            <a href="#" class="btn btn-warning"><i class="fas fa-tasks"></i> Assign Task</a>
                            <a href="#" class="btn btn-success"><i class="fas fa-check"></i> Mark Complete</a>
                        </div>
                    } else if (roles.Contains("Member")) {
                        <div class="d-flex flex-wrap gap-2 mb-2">
                            <a href="#" class="btn btn-info"><i class="fas fa-eye"></i> View Activities</a>
                            <a href="#" class="btn btn-success"><i class="fas fa-comment"></i> Give Feedback</a>
                            <a href="#" class="btn btn-outline-primary"><i class="fas fa-bullhorn"></i> Notices</a>
                            <a href="#" class="btn btn-outline-success"><i class="fas fa-money-bill-wave"></i> Payment & Dues</a>
                            <a href="#" class="btn btn-outline-info"><i class="fas fa-file-alt"></i> View Documents</a>
                            <a href="#" class="btn btn-outline-danger"><i class="fas fa-phone-alt"></i> Emergency Contacts</a>
                        </div>
                    } else if (roles.Contains("President")) {
                        <div class="d-flex flex-wrap gap-2 mb-2">
                            <a href="#" class="btn btn-primary"><i class="fas fa-calendar-alt"></i> Schedule Meeting</a>
                            <a href="#" class="btn btn-info"><i class="fas fa-file-signature"></i> Approve Projects</a>
                        </div>
                    } else if (roles.Contains("Secretary")) {
                        <div class="d-flex flex-wrap gap-2 mb-2">
                            <a href="#" class="btn btn-info"><i class="fas fa-file-upload"></i> Upload Document</a>
                            <a href="#" class="btn btn-warning"><i class="fas fa-bullhorn"></i> Send Notice</a>
                        </div>
                    }
                </div>
                @RenderBody()
            </div>


            <!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P6RD5GCL"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-L53VQ78ZL0"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-L53VQ78ZL0');
</script>


            <!-- Footer -->
            <footer class="main-footer">
                <div class="footer-container">
                    <div class="footer-links mb-2">
                        <a href="#">Privacy Policy</a>|
                        <a href="#">Terms of Service</a>|
                        <a href="https://facebook.com" target="_blank"><i class="fab fa-facebook"></i></a>
                        <a href="https://youtube.com" target="_blank"><i class="fab fa-youtube"></i></a>
                    </div>
                    <div>Copyright © 2025 উত্তরা সেক্টর ১৩ ওয়েলফেয়ার সোসাইটি. All rights reserved.</div>
                </div>
            </footer>
        </div>
    </div>
    @await RenderSectionAsync("Scripts", required: false)
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script>
// Sidebar toggle functionality
function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const mainbar = document.getElementById('mainbar');
    const overlay = document.getElementById('sidebarOverlay');
    
    if (window.innerWidth <= 991) {
        // Mobile behavior - slide in/out with overlay
        sidebar.classList.toggle('show');
        if (overlay) {
            overlay.classList.toggle('show');
        }
    } else {
        // Desktop behavior - collapse/expand
        sidebar.classList.toggle('collapsed');
        mainbar.classList.toggle('collapsed');
    }
}

// Close sidebar function for mobile
function closeSidebar() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebarOverlay');
    
    if (window.innerWidth <= 991) {
        sidebar.classList.remove('show');
        if (overlay) {
            overlay.classList.remove('show');
        }
    }
}

// Close sidebar when clicking outside on mobile
document.addEventListener('click', function(event) {
    const sidebar = document.getElementById('sidebar');
    const sidebarToggle = document.querySelector('.sidebar-toggle-mobile');
    
    if (window.innerWidth <= 991 && sidebar && sidebar.classList.contains('show')) {
        if (!sidebar.contains(event.target) && !sidebarToggle.contains(event.target)) {
            closeSidebar();
        }
    }
});

// Handle window resize
window.addEventListener('resize', function() {
    const sidebar = document.getElementById('sidebar');
    const mainbar = document.getElementById('mainbar');
    const overlay = document.getElementById('sidebarOverlay');
    
    if (window.innerWidth > 991) {
        // Desktop view - remove mobile classes
        sidebar.classList.remove('show');
        if (overlay) {
            overlay.classList.remove('show');
        }
    } else {
        // Mobile view - remove desktop collapse classes
        sidebar.classList.remove('collapsed');
        mainbar.classList.remove('collapsed');
    }
});

// Notifications dropdown
function toggleNotificationsDropdown() {
    const dropdown = document.getElementById('notificationsDropdown');
    if (dropdown) {
        dropdown.style.display = (dropdown.style.display === 'block' ? 'none' : 'block');
    }
}

// Close notifications dropdown when clicking outside
document.addEventListener('click', function(event) {
    const dropdown = document.getElementById('notificationsDropdown');
    const btn = document.querySelector('.notifications-btn');
    if (dropdown && btn && !btn.contains(event.target) && !dropdown.contains(event.target)) {
        dropdown.style.display = 'none';
    }
});

// Theme toggle
function toggleTheme() {
    document.body.classList.toggle('dark-theme');
    if(document.body.classList.contains('dark-theme')) {
        localStorage.setItem('theme', 'dark');
    } else {
        localStorage.setItem('theme', 'light');
    }
}

// Load saved theme on page load
window.onload = function() {
    if(localStorage.getItem('theme') === 'dark') {
        document.body.classList.add('dark-theme');
    }
    
    // Load sidebar state
    const sidebarState = localStorage.getItem('sidebarCollapsed');
    if (sidebarState === 'true' && window.innerWidth > 991) {
        const sidebar = document.getElementById('sidebar');
        const mainbar = document.getElementById('mainbar');
        if (sidebar && mainbar) {
            sidebar.classList.add('collapsed');
            mainbar.classList.add('collapsed');
        }
    }
}

// Save sidebar state when toggled
function saveSidebarState() {
    const sidebar = document.getElementById('sidebar');
    if (sidebar && window.innerWidth > 991) {
        localStorage.setItem('sidebarCollapsed', sidebar.classList.contains('collapsed'));
    }
}

// Update toggleSidebar to save state
const originalToggleSidebar = toggleSidebar;
toggleSidebar = function() {
    originalToggleSidebar();
    saveSidebarState();
};

// Sidebar dropdown toggle
function toggleSidebarDropdown(event) {
    event.preventDefault();
    var parent = event.target.closest('.sidebar-dropdown-parent');
    var dropdown = parent.querySelector('.sidebar-dropdown');
    if (dropdown.style.display === 'none' || dropdown.style.display === '') {
        dropdown.style.display = 'block';
    } else {
        dropdown.style.display = 'none';
    }
}
</script>
</body>
</html> 
